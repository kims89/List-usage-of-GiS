<!doctype html>
<html lang="no">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Stromless I Agder</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.13/semantic.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">
  <script src="https://momentjs.com/downloads/moment-with-locales.js"></script>

  <script>
    moment.locale("nb");
    var myURL =
      "https://www.aenett.no/arcgis/rest/services/Ekstern/DMSPublicStromstansNyeSymboler/MapServer/0/query?f=json&where=1%3D1&returnGeometry=true&spatialRel=esriSpatialRelIntersects&outFields=*&outSR=102100";
    $.getJSON(myURL, function (data) {
      var AlarmHTML = "";
      var customNum = 0;
      console.log(data);
      if (data.features.length > 0) {
        for (i = 0; i < data.features.length; i++) {
          var objData = data.features[i].attributes;
          customNum +=objData.NUM_AB;
          var txtCusIn = "";
          if (objData.CUSTOMER_WEB_TEXT==null){
            txtCusIn = "";
          }
          else {
            txtCusIn = objData.CUSTOMER_WEB_TEXT;
          }

          AlarmHTML += '<div class="animated zoomIn ui icon negative message">'+
						'<i class="notched circle loading icon"></i>'+
						'<div class="content">'+
								'<div class="header">'+
                  moment(objData.STARTTIME).startOf('hour').fromNow()+': '+objData.MUNICIPAL_TXT+' <a class="ui green label">'+objData.TYPE_TXT+'</a>'+
								'</div>'+
								'<p>'+txtCusIn+'</p>'+
								'<div class="ui label">'+
										'Kunder uten strøm'+
										'<div class="detail">'+objData.NUM_AB+'</div>'+
								'</div>'+
						'</div>'+
				  '</div>';          


          console.log("Sted " + objData.MUNICIPAL_TXT);
          console.log("Kunder ute " + objData.NUM_AB);
          console.log("Tilstand " + objData.STATE_TXT);
          console.log("Type " + objData.TYPE_TXT);
          console.log("Tid startet " + objData.STARTTIME);
          console.log("Prioritering " + objData.GRIDLEVEL_TXT);
          console.log("Textkunder " + objData.CUSTOMER_WEB_TEXT);
        } 
      }
      else {
        AlarmHTML ='<div class="animated zoomIn ui success message">'+
						'<div class="content">'+
								'<div class="header">'+
										'Ingen strømbrudd for øyeblikket!'+
								'</div>'+
								'<p>Jippi!!</p>'+
						'</div>'+
				'</div>';

    
}
$( document ).ready(function() {
  var customOutHTML = "";
  if (customNum > 0) {
    customOutHTML = '<div class="ui inverted segment">'+
						'<div class="ui yellow inverted statistic">'+
								'<div class="value">'+
										'<i class="fa fa-users" aria-hidden="true"></i> '+customNum+
								'</div>'+
								'<div class="label">'+
										'er berørt av strømbrudd akkurat nå (Agder Energis forsyningsområdet)'+
								'</div>'+
						'</div>'+
				'</div>';
  }
  else {
    customOutHTML = '<div class="ui segment">'+
						'<div class="ui green statistic">'+
								'<div class="value">'+
										'<i class="fa fa-users" aria-hidden="true"></i> Ingen'+
								'</div>'+
								'<div class="label">'+
										'er berørt av strømbrudd akkurat nå (Agder Energis forsyningsområdet)'+
								'</div>'+
						'</div>'+
				'</div>';
  }
  $("#numCus").html(customOutHTML);
  $("#Cases").html(AlarmHTML);
});
    });
  </script>
</head>

<body>
  <div class="ui raised very padded text container segment">
    <h1 class="ui dividing header">
      <div class="content">
        Strømbrudd i Agder
        <div class="sub header">Alle pågående strømbrudd i Agder Energi sitt forsyningsnett vil vises. Alle dataer er hentet fra Agder Energi/Powels
          APIer </div>
      </div>
    </h1>
    <div id="numCus">
    </div><br>
    <div class="ui horizontal divider">
      Pågående
    </div>
    <div id="Cases"></div>
  </div>
</body>

</html>